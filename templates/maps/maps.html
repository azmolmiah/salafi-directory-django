{% extends 'base.html' %} {% load static %} 
{% block title %} | About {% endblock %} 
{% block content %}
  <div class="container py-5">
    <div id="map" style="width:100%; height:400px" class="chart"></div>
  </div>
    <script type="text/javascript" src="https://js.api.here.com/v3/3.1/mapsjs-core.js"></script>
    <script type="text/javascript" src="https://js.api.here.com/v3/3.1/mapsjs-service.js"></script>
    <script type="text/javascript" src="https://js.api.here.com/v3/3.1/mapsjs-ui.js"></script>
    <script type="text/javascript" src="https://js.api.here.com/v3/3.1/mapsjs-mapevents.js"></script>
  <script type="text/javascript" src="https://js.api.here.com/v3/3.1/mapsjs-clustering.js"></script>
  <script>
    function addMarkerToGroup(group, coordinate, html) {
      var marker = new H.map.Marker(coordinate);
      // add custom data to the marker
      marker.setData(html);
      group.addObject(marker);
    }
    
    function addInfoBubble(map, data) {
      var group = new H.map.Group();
    
      map.addObject(group);
    
      // add 'tap' event listener, that opens info bubble, to the group
      group.addEventListener('tap', function (evt) {
        // event target is the marker itself, group is a parent event target
        // for all objects that it contains
        var bubble =  new H.ui.InfoBubble(evt.target.getGeometry(), {
          // read custom data
          content: evt.target.getData()
        });
        // show info bubble
        ui.addBubble(bubble);
      }, false);

      data.map(item => {
        console.log(item)
        addMarkerToGroup(group, {lat:item[0], lng:item[1]},
        `<div >lat: ${item[0]}, lng: ${item[1]}</div>`);
      })
    
    }
    
    // In your own code, replace variable window.apikey with your own apikey
    var platform = new H.service.Platform({
      apikey: 'YGbOQBSu-ZHkQzT1U0iXNNRMPN0ZGLLVB6Qw1eOvVjs'
    });

    var defaultLayers = platform.createDefaultLayers();

    // Step 2: initialize a map
    var map = new H.Map(document.getElementById('map'), defaultLayers.vector.normal.map, {
      center: new H.geo.Point(52.4068, -1.5197),
      zoom: 6.5,
      pixelRatio: window.devicePixelRatio || 1
    });
    // add a resize listener to make sure that the map occupies the whole container
    window.addEventListener('resize', () => map.getViewPort().resize());

    var behavior = new H.mapevents.Behavior(new H.mapevents.MapEvents(map));

    var ui = H.ui.UI.createDefault(map, defaultLayers);

    var latlng = '{{latlng}}'
    console.log(JSON.parse(latlng))
    addInfoBubble(map, JSON.parse(latlng));
   

  </script>
{% endblock %}
